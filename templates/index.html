<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motor Position</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Motor Position</h1>
    <div id="position1">Motor 1 Position: Fetching...</div>
    <div id="position2">Motor 2 Position: Fetching...</div>

    <!-- Add a form for setting the motor position -->
    <div>
        <label for="motorSelector">Choose Motor:</label>
        <select id="motorSelector">
            <option value="14">Motor 1</option>
            <option value="15">Motor 2</option>
        </select>

        <label for="angleInput">Set Motor Angle:</label>
        <input type="text" id="angleInput" placeholder="Enter angle in degrees">
        <button id="setAngleButton">Set Angle</button>
    </div>

    <!-- Result message div -->
    <div id="resultMessage" style="display: none;">
        <span id="resultIcon"></span>
        <span id="resultText"></span>
    </div>

    <script>
        function fetchPosition() {
            // Fetch for Motor 1
            $.ajax({
                url: '/get_position?motor_id=14',
                method: 'GET',
                success: function(data) {
                    if (data.position !== undefined && data.position !== null) {
                        $('#position1').text(`Motor 1 Position: ${data.position}`);
                    } else if (data.error) {
                        $('#position1').text(`Error: ${data.error}`);
                    }
                }
            });

            // Fetch for Motor 2
            $.ajax({
                url: '/get_position?motor_id=15',
                method: 'GET',
                success: function(data) {
                    if (data.position !== undefined && data.position !== null) {
                        $('#position2').text(`Motor 2 Position: ${data.position}`);
                    } else if (data.error) {
                        $('#position2').text(`Error: ${data.error}`);
                    }
                }
            });
        }

        // Fetch the position every 2 seconds
        setInterval(fetchPosition, 2000);

        // Function to set the motor position using a POST request
        $('#setAngleButton').click(function() {
            const motor_id = $('#motorSelector').val();
            const angle = $('#angleInput').val();
            $.post(`/set_position?motor_id=${motor_id}`, { position: angle }, function(data) {
                if (data.status === 'success') {
                    // Display success message
                    $('#resultIcon').text('✓').addClass('success').removeClass('error');
                    $('#resultText').text(data.message).addClass('success').removeClass('error');
                    $('#resultMessage').show();
                    fetchPosition();
                } else {
                    // Display error message
                    $('#resultIcon').text('✗').addClass('error').removeClass('success');
                    $('#resultText').text(`Error: ${data.message}`).addClass('error').removeClass('success');
                    $('#resultMessage').show();
                }
            });
        });
    </script>
</body>
</html>
